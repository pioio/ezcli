# Usage Examples
(This page was autogenerated, do not edit manually)

Best way to learn is by example. Here are some ways of how to use `taskcli` along with the command output.

All of the examples below can also be found in the `examples/` directory of the project.

To run a specific example from the `examples/` dir yourself, do this:
```
cd examples/
t -f filename.py [optional-args]
```

Also, [go here for a cheat sheet](cheatsheet.md) -- it's a more concise version of some of the examples below.

### Basic Customize Settings
`examples/basic_customize_settings.py`  
```python
"""Most basic example of a task.

Tags: basic

Run:
- taskcli -f FILENAME             # list tasks
- taskcli -f FILENAME  task1      # will call second task several time
- taskcli -f FILENAME  say-hello yeti # call it directly
"""
from taskcli import task, tt

# Here we change the default, to print a message whenever we enter a task
tt.config.print_task_start_message = True


@task
def task1():
    """This task has two positional arguments, one of them is optional."""
    print("Starting the first task", flush=True)
    say_hello("alice")
    say_hello("bob")
    say_hello("charlie")

    # But we can choose to disable it for this call, simply change it at any time
    # >  tt.config.print_task_start_message = False
    say_hello("dylan")


@task
def say_hello(name="alice"):
    """This task has one positional, and one named optional argument.

    Args after the "*" are named options only.
    """
    print(f"Hello from task2, {name=}", flush=True)
```
##### Output of the above:
```sh
### list tasks
# taskcli -f basic_customize_settings.py
default               Default tasks
say-hello             This task has one positional, and one named optional argument.
task1                 This task has two positional arguments, one of them is optional.
```

```sh
### will call second task several time
# taskcli -f basic_customize_settings.py  task1
―― taskcli [task1] ―――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
Starting the first task
―― taskcli [task1 > say-hello] ―――――――――――――――――――――――――――――――――――――――――――――――――
Hello from task2, name='alice'
――
―― taskcli [task1 > say-hello] ―――――――――――――――――――――――――――――――――――――――――――――――――
Hello from task2, name='bob'
――
―― taskcli [task1 > say-hello] ―――――――――――――――――――――――――――――――――――――――――――――――――
Hello from task2, name='charlie'
――
―― taskcli [task1 > say-hello] ―――――――――――――――――――――――――――――――――――――――――――――――――
Hello from task2, name='dylan'
――
――
```

```sh
### call it directly
# taskcli -f basic_customize_settings.py  say-hello yeti
―― taskcli [say-hello] ―――――――――――――――――――――――――――――――――――――――――――――――――――――――――
Hello from task2, name='yeti'
――
```

---
### Dynamic Task Creation
`examples/dynamic_task_creation.py`  
```python
"""Create tasks dynamically.

And to make it interesting, each task has a different default argument.

Tags: basic

Run:
- t -f FILENAME               # list tasks
- t -f FILENAME  foobar-1
- t -f FILENAME  foobar-5 --person-name Lex
- t -f FILENAME  call-all-dynamic-foobars

"""

from taskcli import task, tt

# Different default args for each task
names = ["Alice", "Bob", "Charlie", "Dylan", "Eve", "Frank", "Grace", "Helen"]

for x in range(7):
    # To avoid name clashes, we will need to assign unique name to each task.
    task_name = f"foobar-{x}"

    person_name = names[x]

    @task(name=task_name, desc=f"Task number {x}")
    def foobar(x=x, *, person_name=person_name):  # x=x is needed to bind the loop variable (important!)
        print(f"Hello, {person_name}! ".ljust(20) + f"({x=})")


@task
def call_all_dynamic_foobars():
    """Call all the dynamically created tasks."""
    tasks = tt.get_tasks()  # returns all the tasks present in this module
    for task in tasks:
        if task.name.startswith("foobar"):
            task.func()
```
##### Output of the above:
```sh
### list tasks
# t -f dynamic_task_creation.py
default               Default tasks
call-all-dynamic-foobars Call all the dynamically created tasks.
foobar-0              Task number 0
foobar-1              Task number 1
foobar-2              Task number 2
foobar-3              Task number 3
foobar-4              Task number 4
foobar-5              Task number 5
foobar-6              Task number 6
```

```sh
# t -f dynamic_task_creation.py  foobar-1
Hello, Bob!         (x=1)
```

```sh
# t -f dynamic_task_creation.py  foobar-5 --person-name Lex
Hello, Lex!         (x=5)
```

```sh
# t -f dynamic_task_creation.py  call-all-dynamic-foobars
Hello, Alice!       (x=0)
Hello, Bob!         (x=1)
Hello, Charlie!     (x=2)
Hello, Dylan!       (x=3)
Hello, Eve!         (x=4)
Hello, Frank!       (x=5)
Hello, Grace!       (x=6)
```

---
### Basic Using Arguments
`examples/basic_using_arguments.py`  
```python
"""Two tasks with arguments.

The "*" in the function signature is the Python syntax for denoting keyword (i.e. named) only arguments.
`taskcli` uses this same logic to distinguish between positional and named arguments.

Tags: basic

Run:
- t -f FILENAME  -lll               # list, detailed view
- t -f FILENAME  task1  --help      # Show help output
- t -f FILENAME  task2  --help      # Show help output
- t -f FILENAME  task1  100         # task1 requires the first argument, but second one is optional
- t -f FILENAME  task1  100  bruno  # task1 requires the first argument, but second one is optional
- t -f FILENAME  task2              # task2 does not require any args, both are optional
- t -f FILENAME  task2  --name bob
- t -f FILENAME  task2  --name bob 193

"""
from taskcli import task, tt

@task
def task1(age: int, name: str = "alice"):
    """This task has two positional arguments, one of them is optional."""
    # The basic types are already converted to their correct types
    assert isinstance(age, int)
    assert isinstance(name, str)
    print(f"Hello from task1: {age=} {name=}")

@task
def task2(height: int = 42, *, name: str = "alice"):
    """This task has one positional, and one named optional argument.

    The args after the "*" are named options only (i.e. --name).
    """
    print(f"Hello from task2: {height=} {name=}")
```
##### Output of the above:
```sh
### list, detailed view
# t -f basic_using_arguments.py  -lll
default               Default tasks
task1                 This task has two positional arguments, one of them is optional.
  AGE, NAME=alice
task2                 This task has one positional, and one named optional argument.
  HEIGHT=42, --name=alice
```

```sh
### Show help output
# t -f basic_using_arguments.py  task1  --help
usage: t task1 [-h] age [name]

positional arguments:
  age
  name

options:
  -h, --help  show this help message and exit
```

```sh
### Show help output
# t -f basic_using_arguments.py  task2  --help
usage: t task2 [-h] [--name NAME] [height]

positional arguments:
  height

options:
  -h, --help            show this help message and exit
  --name NAME, -n NAME
```

```sh
### task1 requires the first argument, but second one is optional
# t -f basic_using_arguments.py  task1  100
Hello from task1: age=100 name='alice'
```

```sh
### task1 requires the first argument, but second one is optional
# t -f basic_using_arguments.py  task1  100  bruno
Hello from task1: age=100 name='bruno'
```

```sh
### task2 does not require any args, both are optional
# t -f basic_using_arguments.py  task2
Hello from task2: height=42 name='alice'
```

```sh
# t -f basic_using_arguments.py  task2  --name bob
Hello from task2: height=42 name='bob'
```

```sh
# t -f basic_using_arguments.py  task2  --name bob 193
Hello from task2: height=193 name='bob'
```

---
### Debugging
`examples/debugging.py`  
```python
"""Examples how to troubleshoot taskcli.

Run:
- t -f FILENAME debug-a-task
- t -f FILENAME list-tasks
- t -f FILENAME debug-config | head -10   # print the first 10 lines of the config fields
"""

from taskcli import tt, task

# This will pretty print the all settings current config AFTER your
# custom env vars and cli args have been applied.
# I.e. this is typically what you want to use
@task
def debug_config():
    """Print all settings of current config."""
    tt.config.debug() # you can pass it a function which you want to use to print

@task
def debug_a_task():
    """Print detailed info about a specific task.

    Can also be used for tasks included from other file.
    """
    thetask = tt.get_task("debug-a-task")
    thetask.debug()

@task
def list_tasks():
    """List all available tasks."""
    for t in tt.get_tasks():
        print(f"{t.name=}, {t.hidden=}")


# Alternatively, calling tt.config.debug() in the global scope
# will pretty print all setting of current config BEFORE env vars
# and cli args have been applied.
# Example:
# tt.config.debug()

# Finally, you can always run with  "-v", "-vv", or "-vvv" to get more debug info.
```
##### Output of the above:
```sh
# t -f debugging.py debug-a-task
  _name: 
  _desc: 
  func:
     debug_a_task
  name_namespaces: []
  _extra_summary: []
  _aliases: []
  tags: []
  env: []
  hidden: False
  important: False
  from_above: False
  from_parent: False
  params:
  name_format: {name}
  customize_parser: None
  is_go_task: False
  suppress_warnings: False
  distance: 0
  group: Group(default, hidden=False)
  code_location: unknown:1
  included_from: None
```

```sh
# t -f debugging.py list-tasks
t.name='debug-config', t.hidden=False
t.name='debug-a-task', t.hidden=False
t.name='list-tasks', t.hidden=False
```

```sh
### print the first 10 lines of the config fields
# t -f debugging.py debug-config | head -10
init=False
tags=[]
group_order=['default']
search=
parent=False
color=
show_hidden=False
run_show_location=False
no_go_task=False
show_hidden_groups=False
```

---
### Basic
`examples/basic.py`  
```python
"""Most basic example of a task.

Tags: basic

Run:
- t -f FILENAME                 # list tasks
- taskcli -f FILENAME           # list tasks, equivalent to 't'
- tt -f FILENAME                # list tasks, including hidden ones
- t -f FILENAME hello           # run the hello taask
- t -f FILENAME hello-hidden    # run the hidden task

"""
from taskcli import task, tt


@task
def hello():
    """This line will become the summary for the task list output."""
    print("Hello, World!")


@task(hidden=True)
def hello_hidden():
    """This task is hidden by default.

    You can run it with `t`, even though it's not shown in the task list by default.
    """
    print("Hello from the hidden task!")
```
##### Output of the above:
```sh
### list tasks
# t -f basic.py
default               Default tasks
hello                 This line will become the summary for the task list output.
1 hidden
```

```sh
### list tasks, equivalent to 't'
# taskcli -f basic.py
default               Default tasks
hello                 This line will become the summary for the task list output.
1 hidden
```

```sh
### list tasks, including hidden ones
# tt -f basic.py
default               Default tasks
hello                 This line will become the summary for the task list output.
1 hidden
```

```sh
### run the hello taask
# t -f basic.py hello
Hello, World!
```

```sh
### run the hidden task
# t -f basic.py hello-hidden
Hello from the hidden task!
```

---
### Customize Parser
`examples/customize_parser.py`  
```python
"""Shows how to customize the underlying `argparse` parser.

Tags: basic

Run:
- t -f FILENAME foobar --help              # show available arguments
- t -f FILENAME foobar --custom-arg 123    # use the custom argument we added

"""

import taskcli
from taskcli import task
import taskcli.core

def customize_parser(parser):
    """Customize the argparse parser."""
    parser.add_argument("--custom-arg", "-c",
                        help="Custom argument",
                        default=42,
                        type=int)


@task(customize_parser=customize_parser)
def foobar(name:str="Alice") -> None:
    """Task which customizes the parser."""
    parsed_args = taskcli.core.get_runtime().parsed_args
    assert parsed_args is not None
    print(f"Hello, {name=}!")
    print("Value of custom-arg (set with --custom-arg <value>):", parsed_args.custom_arg)
```
##### Output of the above:
```sh
### show available arguments
# t -f customize_parser.py foobar --help
usage: t foobar [-h] [--custom-arg CUSTOM_ARG] [name]

positional arguments:
  name

options:
  -h, --help            show this help message and exit
  --custom-arg CUSTOM_ARG, -c CUSTOM_ARG
                        Custom argument
```

```sh
### use the custom argument we added
# t -f customize_parser.py foobar --custom-arg 123
Hello, name='Alice'!
Value of custom-arg (set with --custom-arg <value>): 123
```

---
### Extra Arguments
`examples/extra_arguments.py`  
```python
"""How to pass arbitrary arguments to tasks.

Tags: basic

Run:
- t -f FILENAME hash-it -- -sha256                                   # only extra args
- t -f FILENAME hash-it "Hello, Alice!"                                   # only positional arg
- t -f FILENAME hash-it "Hello, Bob!" -- -sha256 -hmac "secret"         # positional and extra args,
- t -f FILENAME hash-it "Hello, Charlie!" -r 3 -- -sha256 -hmac "secret"    # positional, options, and extra args

"""
import re
from taskcli import task, tt, run


@task
def hash_it(text="Hello, Foobar!", *, repeat:int=1):
    """Run a ping command and pass all extra args to it."""
    # Get the arguments as a list
    for arg in tt.get_extra_args_list():
        print("Extra arg: " + arg, flush=True)

    # Or, get them as a string, ready to be passed to a command
    # string will be empty if none were passed
    extra_args = tt.get_extra_args() or "-md5"

    for _ in range(repeat):
        run(f'echo -n "{text}" | openssl dgst {extra_args}')

```
##### Output of the above:
```sh
### only extra args
# t -f extra_arguments.py hash-it -- -sha256
Extra arg: -sha256
@@ echo -n "Hello, Foobar!" | openssl dgst -sha256
SHA2-256(stdin)= 735a1dafb02dc26d56476612ebf3c4ccd9cced34bd215c8a74e7095040a9953d
```

```sh
### only positional arg
# t -f extra_arguments.py hash-it "Hello, Alice!"
@@ echo -n "Hello, Alice!" | openssl dgst -md5
MD5(stdin)= ceff6e399c3c8cfcf7f5a5e1321329a6
```

```sh
### positional and extra args,
# t -f extra_arguments.py hash-it "Hello, Bob!" -- -sha256 -hmac "secret"
Extra arg: -sha256
Extra arg: -hmac
Extra arg: secret
@@ echo -n "Hello, Bob!" | openssl dgst -sha256 -hmac secret
SHA2-256(stdin)= d3bfb033501ca62eef75f4d3bb4bad57c06de76f4e36f0e15cd43b2af557a609
```

```sh
### positional, options, and extra args
# t -f extra_arguments.py hash-it "Hello, Charlie!" -r 3 -- -sha256 -hmac "secret"
Extra arg: -sha256
Extra arg: -hmac
Extra arg: secret
@@ echo -n "Hello, Charlie!" | openssl dgst -sha256 -hmac secret
SHA2-256(stdin)= 185044d80fe25d3bb89358a86bdf6b98027bfb9902991667e474bfba5bf97598
@@ echo -n "Hello, Charlie!" | openssl dgst -sha256 -hmac secret
SHA2-256(stdin)= 185044d80fe25d3bb89358a86bdf6b98027bfb9902991667e474bfba5bf97598
@@ echo -n "Hello, Charlie!" | openssl dgst -sha256 -hmac secret
SHA2-256(stdin)= 185044d80fe25d3bb89358a86bdf6b98027bfb9902991667e474bfba5bf97598
```

---
