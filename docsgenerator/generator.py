from taskcli import task, tt, taskcliconfig
from datetime import datetime
import os
import logging
log =  logging.getLogger(__name__)

def autogen_header():
    timedate = datetime.now(tz=None).strftime("%Y-%m-%d %H:%M:%S")
    return f"""(This page was autogenerated by `{timedate}`, do not edit manually)"""

def generate_settings() -> str:
    config = taskcliconfig.TaskCLIConfig()

    out = "# Configuration fields\n"
    out += autogen_header()
    BR = "  "
    for field in config.get_fields():
        out += f"#### {field.name}\n"
        out += f"{field.desc}{BR}\n"
        if field.env:
            out += f"{field.env_var_name}{BR}\n"
        else:
            out += f"(no env var){BR}\n"

        out += "\n"

    return out


def write_file(path: str, content: str) -> None:
    assert path.startswith("../docs/")
    abs_path = os.path.abspath(path)
    with open(abs_path, "w") as f:
        f.write(content)

    log.info(f"Written file: {abs_path}")
